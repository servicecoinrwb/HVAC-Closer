<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HVAC Sales Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.292.0/lucide.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .btn-primary {
            background-color: #2563eb;
            color: white;
        }
        .btn-primary:hover {
            background-color: #1d4ed8;
        }
        .btn-secondary {
            background-color: #e5e7eb;
            color: #374151;
        }
        .btn-secondary:hover {
            background-color: #d1d5db;
        }
        .input-field {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            transition: border-color 0.2s;
        }
        .input-field:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
        }
        .tab {
            padding: 0.75rem 1.25rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            color: #6b7280;
            font-weight: 500;
        }
        .tab.active {
            color: #2563eb;
            border-bottom-color: #2563eb;
        }
        .proposal-card {
            border: 2px solid #e5e7eb;
            transition: all 0.3s ease;
        }
        .proposal-card.best {
            border-color: #2563eb;
            box-shadow: 0 10px 15px -3px rgb(37 99 235 / 0.2), 0 4px 6px -4px rgb(37 99 235 / 0.2);
        }
        .tag {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="app" class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="flex items-center justify-between mb-8">
            <div class="flex items-center gap-3">
                <div class="bg-blue-600 p-3 rounded-lg text-white">
                    <i data-lucide="wind"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-gray-800">HVAC Sales Tool</h1>
                    <p class="text-gray-500">Streamline your sales process.</p>
                </div>
            </div>
            <button id="resetBtn" class="btn btn-secondary">
                <i data-lucide="rotate-cw" class="mr-2 h-4 w-4"></i>
                Start New Proposal
            </button>
        </header>

        <!-- Main Content -->
        <main>
            <!-- Step 1: Customer & Home Info -->
            <div class="card">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center"><span class="bg-blue-100 text-blue-700 rounded-full h-8 w-8 flex items-center justify-center font-bold mr-3">1</span> Customer & Home Evaluation</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="customerName" class="block text-sm font-medium text-gray-700 mb-1">Customer Name</label>
                        <input type="text" id="customerName" class="input-field" placeholder="e.g., John Doe">
                    </div>
                    <div>
                        <label for="customerAddress" class="block text-sm font-medium text-gray-700 mb-1">Address</label>
                        <input type="text" id="customerAddress" class="input-field" placeholder="e.g., 123 Main St, Anytown">
                    </div>
                    <div>
                        <label for="homeSqFt" class="block text-sm font-medium text-gray-700 mb-1">Home Square Footage</label>
                        <input type="number" id="homeSqFt" class="input-field" placeholder="e.g., 2000">
                    </div>
                    <div>
                        <label for="systemSize" class="block text-sm font-medium text-gray-700 mb-1">Required System Size (Tons)</label>
                        <select id="systemSize" class="input-field">
                            <option value="">Select Tonnage</option>
                            <option value="1.5">1.5 Tons</option>
                            <option value="2">2 Tons</option>
                            <option value="2.5">2.5 Tons</option>
                            <option value="3">3 Tons</option>
                            <option value="3.5">3.5 Tons</option>
                            <option value="4">4 Tons</option>
                            <option value="5">5 Tons</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Customer Priorities (Select all that apply)</label>
                        <div class="flex flex-wrap gap-3 mt-2">
                            <button class="priority-btn btn btn-secondary" data-priority="Energy Savings"><i data-lucide="zap" class="mr-2 h-4 w-4"></i>Energy Savings</button>
                            <button class="priority-btn btn btn-secondary" data-priority="Improved Comfort"><i data-lucide="thermometer-sun" class="mr-2 h-4 w-4"></i>Improved Comfort</button>
                            <button class="priority-btn btn btn-secondary" data-priority="Quiet Operation"><i data-lucide="volume-x" class="mr-2 h-4 w-4"></i>Quiet Operation</button>
                            <button class="priority-btn btn btn-secondary" data-priority="Air Quality"><i data-lucide="leaf" class="mr-2 h-4 w-4"></i>Air Quality</button>
                            <button class="priority-btn btn btn-secondary" data-priority="Budget"><i data-lucide="dollar-sign" class="mr-2 h-4 w-4"></i>Budget</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Build System -->
            <div class="card text-center">
                 <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center justify-center"><span class="bg-blue-100 text-blue-700 rounded-full h-8 w-8 flex items-center justify-center font-bold mr-3">2</span> Generate Proposal</h2>
                <button id="buildSystemBtn" class="btn btn-primary btn-lg">
                    <i data-lucide="settings-2" class="mr-2 h-5 w-5"></i>
                    Build System Options
                </button>
            </div>

            <!-- Step 3: Proposal -->
            <div id="proposalSection" class="hidden">
                <div class="card">
                    <h2 class="text-xl font-bold text-gray-800 mb-2 flex items-center"><span class="bg-blue-100 text-blue-700 rounded-full h-8 w-8 flex items-center justify-center font-bold mr-3">3</span> Your Custom Proposal</h2>
                    <p class="text-gray-600 mb-6">Here are three tailored options based on your home's needs and priorities.</p>
                    
                    <div id="proposalOutput" class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Proposal cards will be inserted here -->
                    </div>
                </div>

                <!-- Financing Calculator -->
                <div class="card">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center"><i data-lucide="calculator" class="mr-3 text-blue-600"></i>Financing Calculator</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-end">
                        <div>
                            <label for="loanAmount" class="block text-sm font-medium text-gray-700 mb-1">Investment Amount</label>
                            <input type="number" id="loanAmount" class="input-field" placeholder="Enter total price">
                        </div>
                        <div>
                            <label for="loanTerm" class="block text-sm font-medium text-gray-700 mb-1">Loan Term (Years)</label>
                            <select id="loanTerm" class="input-field">
                                <option value="3">3 Years</option>
                                <option value="5">5 Years</option>
                                <option value="7">7 Years</option>
                                <option value="10">10 Years</option>
                            </select>
                        </div>
                        <div class="text-center">
                             <button id="calculatePaymentBtn" class="btn btn-primary w-full">Calculate Payment</button>
                        </div>
                    </div>
                    <div id="paymentResult" class="mt-6 text-center hidden">
                        <p class="text-gray-600">Estimated Monthly Payment:</p>
                        <p class="text-4xl font-bold text-blue-600" id="monthlyPayment"></p>
                        <p class="text-xs text-gray-500 mt-1">Based on an estimated 9.99% APR. For estimation purposes only.</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const equipmentData = {
            "furnaces": {
                "modulating": [
                    {"item": "G97CMN0601714A", "desc": "97% 3-1/2T 60mbh Modulating Ion", "price": 3703.94},
                    {"item": "G97CMN0801714A", "desc": "97% 3-1/2T 80mbh Modulating Ion", "price": 3887.17},
                    {"item": "G97CMN0802120A", "desc": "97% 5T 80mbh Modulating Ion", "price": 4185.49},
                    {"item": "G97CMN1002122A", "desc": "97% 5-1/2T 100mbh Modulating Ion", "price": 4408.09},
                    {"item": "G97CMN1202422A", "desc": "97% 5-1/2T 120mbh Modulating Ion", "price": 4642.80}
                ],
                "2-stage": [
                    {"item": "G96CTN0601714A", "desc": "96% 3-1/2T 60mbh 2-Stage Ion", "price": 3027.06},
                    {"item": "G96CTN0801714A", "desc": "96% 3-1/2T 80mbh 2-Stage Ion", "price": 3205.74},
                    {"item": "G96CTN0802120A", "desc": "96% 5T 80mbh 2-Stage Ion", "price": 3514.66},
                    {"item": "G96CTN1002122A", "desc": "96% 5-1/2T 100mbh 2-Stage Ion", "price": 3732.71},
                    {"item": "G96CTN1202422A", "desc": "96% 5-1/2T 120mbh 2-Stage Ion", "price": 3976.51}
                ],
                "performance": [
                    {"item": "N95ESN0601714A", "desc": "96% 3-1/2T 60mbh ECM Performance", "price": 2018.54},
                    {"item": "N95ESN0801716A", "desc": "96% 4T 80mbh ECM Performance", "price": 2186.63},
                    {"item": "N95ESN0802120A", "desc": "96% 5T 80mbh ECM Performance", "price": 2206.31},
                    {"item": "N95ESN1002122A", "desc": "96% 5T 100mbh ECM Performance", "price": 2415.29},
                    {"item": "N95ESN1202422A", "desc": "96% 5-1/2T 120mbh ECM Performance", "price": 2522.80}
                ]
            },
            "ac": {
                "variable-speed": [
                    {"item": "HVA924GK", "desc": "2T Varispeed 19 SEER2 Ion", "size": 2, "price": 4456.54},
                    {"item": "HVA936GK", "desc": "3T Varispeed 19 SEER2 Ion", "size": 3, "price": 5421.14},
                    {"item": "HVA948GK", "desc": "4T Varispeed 19 SEER2 Ion", "size": 4, "price": 5907.23},
                    {"item": "HVA960GK", "desc": "5T Varispeed 19 SEER2 Ion", "size": 5, "price": 6552.31}
                ],
                "2-stage": [
                    {"item": "N4A7T24AKA", "desc": "2T 17 SEER2 2-Stage", "size": 2, "price": 2680.29},
                    {"item": "N4A7T36AKA", "desc": "3T 17 SEER2 2-Stage", "size": 3, "price": 3198.17},
                    {"item": "N4A7T48AKA", "desc": "4T 17 SEER2 2-Stage", "size": 4, "price": 3922.00},
                    {"item": "N4A7T60AKA", "desc": "5T 17 SEER2 2-Stage", "size": 5, "price": 4417.17}
                ],
                "1-stage-16": [
                    {"item": "N4A5S18AKA", "desc": "1.5T 16 SEER2 1-Stage", "size": 1.5, "price": 1962.51},
                    {"item": "N4A5S24AKA", "desc": "2T 16 SEER2 1-Stage", "size": 2, "price": 2113.94},
                    {"item": "N4A5S30AKA", "desc": "2.5T 16 SEER2 1-Stage", "size": 2.5, "price": 2277.49},
                    {"item": "N4A5S36AKA", "desc": "3T 16 SEER2 1-Stage", "size": 3, "price": 2613.66},
                    {"item": "N4A5S48AKA", "desc": "4T 15 SEER2 1-Stage", "size": 4, "price": 3310.23},
                    {"item": "N4A5S60AKA", "desc": "5T 15 SEER2 1-Stage", "size": 5, "price": 3793.29}
                ]
            },
            "coils": [
                {"item": "EVD4X18M14A", "size": 1.5, "price": 651.14},
                {"item": "EVD4X24M14A", "size": 2, "price": 696.57},
                {"item": "EVD4X30M14A", "size": 2.5, "price": 767.74},
                {"item": "EVD4X36M17A", "size": 3, "price": 764.71},
                {"item": "EVD4X42M17A", "size": 3.5, "price": 894.94},
                {"item": "EVD4X48M21A", "size": 4, "price": 958.54},
                {"item": "EVD4X60M24A", "size": 5, "price": 1099.37}
            ],
            "accessories": {
                "thermostat": {"item": "SYST0101CW", "desc": "Ion Wall Control WiFi Touchscreen", "price": 747.21}
            }
        };

        function initializeApp() {
            // This function contains all the application logic.
            // It will only be called once lucide is confirmed to be loaded.
            
            lucide.createIcons();

            const buildSystemBtn = document.getElementById('buildSystemBtn');
            const proposalSection = document.getElementById('proposalSection');
            const proposalOutput = document.getElementById('proposalOutput');
            const systemSizeSelect = document.getElementById('systemSize');
            const priorityBtns = document.querySelectorAll('.priority-btn');
            const calculatePaymentBtn = document.getElementById('calculatePaymentBtn');
            const resetBtn = document.getElementById('resetBtn');

            let selectedPriorities = [];
            
            priorityBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const priority = btn.dataset.priority;
                    btn.classList.toggle('btn-secondary');
                    btn.classList.toggle('btn-primary');
                    if (selectedPriorities.includes(priority)) {
                        selectedPriorities = selectedPriorities.filter(p => p !== priority);
                    } else {
                        selectedPriorities.push(priority);
                    }
                });
            });

            buildSystemBtn.addEventListener('click', () => {
                const tonnage = parseFloat(systemSizeSelect.value);
                if (!tonnage) {
                    alert('Please select a system size.');
                    return;
                }
                
                generateProposal(tonnage);
                proposalSection.classList.remove('hidden');
            });

            calculatePaymentBtn.addEventListener('click', () => {
                const loanAmount = parseFloat(document.getElementById('loanAmount').value);
                const loanTerm = parseInt(document.getElementById('loanTerm').value);
                
                if (!loanAmount || !loanTerm) {
                    alert('Please enter a valid investment amount.');
                    return;
                }

                const interestRate = 0.0999;
                const monthlyRate = interestRate / 12;
                const numberOfPayments = loanTerm * 12;

                const monthlyPayment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numberOfPayments)) / (Math.pow(1 + monthlyRate, numberOfPayments) - 1);

                document.getElementById('monthlyPayment').textContent = `$${monthlyPayment.toFixed(2)}`;
                document.getElementById('paymentResult').classList.remove('hidden');
            });

            resetBtn.addEventListener('click', () => {
                document.getElementById('customerName').value = '';
                document.getElementById('customerAddress').value = '';
                document.getElementById('homeSqFt').value = '';
                systemSizeSelect.value = '';
                proposalSection.classList.add('hidden');
                proposalOutput.innerHTML = '';
                document.getElementById('paymentResult').classList.add('hidden');
                document.getElementById('loanAmount').value = '';
                selectedPriorities = [];
                priorityBtns.forEach(btn => {
                    btn.classList.remove('btn-primary');
                    btn.classList.add('btn-secondary');
                });
            });

            function findClosest(arr, size) {
                return arr.reduce((prev, curr) => Math.abs(curr.size - size) < Math.abs(prev.size - size) ? curr : prev);
            }

            function generateProposal(tonnage) {
                const furnaceGood = equipmentData.furnaces.performance[1];
                const furnaceBetter = equipmentData.furnaces['2-stage'][1];
                const furnaceBest = equipmentData.furnaces.modulating[1];

                const acGood = findClosest(equipmentData.ac['1-stage-16'], tonnage);
                const acBetter = findClosest(equipmentData.ac['2-stage'], tonnage);
                const acBest = findClosest(equipmentData.ac['variable-speed'], tonnage);

                const coilGood = findClosest(equipmentData.coils, acGood.size);
                const coilBetter = findClosest(equipmentData.coils, acBetter.size);
                const coilBest = findClosest(equipmentData.coils, acBest.size);
                
                const thermostat = equipmentData.accessories.thermostat;

                const goodPackage = {
                    title: "Performance",
                    level: "Good",
                    color: "gray",
                    items: [furnaceGood, acGood, coilGood],
                    features: ["Reliable Operation", "Standard Efficiency", "Budget-Friendly"]
                };

                const betterPackage = {
                    title: "Comfort Series",
                    level: "Better",
                    color: "blue",
                    items: [furnaceBetter, acBetter, coilBetter, thermostat],
                    features: ["Enhanced Comfort", "Higher Energy Savings", "Quieter Operation", "Advanced Control"]
                };
                
                const bestPackage = {
                    title: "Ion Ultimate",
                    level: "Best",
                    color: "indigo",
                    items: [furnaceBest, acBest, coilBest, thermostat],
                    features: ["Maximum Energy Savings", "Ultimate Comfort Control", "Whisper-Quiet Performance", "Smart Communicating System"]
                };

                const packages = [goodPackage, betterPackage, bestPackage];
                proposalOutput.innerHTML = '';

                packages.forEach(pkg => {
                    const totalCost = pkg.items.reduce((sum, item) => sum + item.price, 0);
                    const finalPrice = totalCost + 2500; 

                    const cardHTML = `
                        <div class="card proposal-card ${pkg.level.toLowerCase()}">
                            <div class="text-center">
                                <span class="tag bg-${pkg.color}-100 text-${pkg.color}-700">${pkg.level}</span>
                                <h3 class="text-2xl font-bold text-gray-800 mt-3">${pkg.title}</h3>
                                <div class="my-6">
                                    <span class="text-4xl font-extrabold text-gray-900">$${finalPrice.toFixed(2)}</span>
                                    <span class="text-gray-500"> / installed</span>
                                </div>
                            </div>
                            <div class="mb-6">
                                <h4 class="font-semibold text-gray-700 mb-3">Key Features:</h4>
                                <ul class="space-y-2">
                                    ${pkg.features.map(f => `<li class="flex items-center text-gray-600"><i data-lucide="check-circle" class="h-5 w-5 text-green-500 mr-2"></i>${f}</li>`).join('')}
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-700 mb-3">Equipment Included:</h4>
                                <ul class="space-y-2 text-sm text-gray-500">
                                    ${pkg.items.map(i => `<li><strong>${i.item}:</strong> ${i.desc}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    `;
                    proposalOutput.innerHTML += cardHTML;
                });
                lucide.createIcons();
            }
        }

        // This function will wait until the `lucide` object is available on the window,
        // then it will call the main initializeApp function.
        function waitForLucide() {
            if (typeof lucide !== 'undefined') {
                initializeApp();
            } else {
                setTimeout(waitForLucide, 50); // Check again in 50ms
            }
        }

        // Start the process
        waitForLucide();

    </script>
</body>
</html>
